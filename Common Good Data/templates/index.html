<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script>
    $( function() {
        $( "#start_date" ).datepicker({ dateFormat: 'mm/dd/yy' });
        $( "#end_date" ).datepicker({ dateFormat: 'mm/dd/yy' });

        // Code for handling select all functionality
        $("#select_all_categories").click(function(){
            $('input[name="category"]').not(this).prop('checked', this.checked);
        });
        
        $("#select_all_locations").click(function(){
            $('input[name="location"]').not(this).prop('checked', this.checked);
        });
    } );
    </script>
</head>
<body>
    <form action="/" method="post" class="form-row">
        <div class="form-group col-md-2">
            <label for="graph_type">Graph Type:</label>
            <select id="graph_type" name="graph_type" class="form-control">
                <option value="" disabled selected hidden>Select Option</option>
                <option value="line_chart" {% if request.form.graph_type == 'line_chart' %}selected{% endif %}>Line Chart</option>
                <option value="pie_chart" {% if request.form.graph_type == 'pie_chart' %}selected{% endif %}>Pie Chart</option>
            </select>
        </div>
        <div class="form-group col-md-2">
            <label for="category_option">Category Options:</label>
            <select id="category_option" name="category_option" class="form-control">
                <option value="" disabled selected hidden>Select Option</option>
                <option value="aggregate_categories" {% if request.form.category_option == 'aggregate_categories' %}selected{% endif %}>Aggregate Categories</option>
                <option value="individual_categories" {% if request.form.category_option == 'individual_categories' %}selected{% endif %}>Individual Categories</option>
            </select>
        </div>
        <div class="form-group col-md-2">
            <label for="location_option">Location Options:</label>
            <select id="location_option" name="location_option" class="form-control">
                <option value="" disabled selected hidden>Select Option</option>
                <option value="aggregate_locations" {% if request.form.location_option == 'aggregate_locations' %}selected{% endif %}>Aggregate Locations</option>
                <option value="individual_locations" {% if request.form.location_option == 'individual_locations' %}selected{% endif %}>Individual Locations</option>
            </select>
        </div>
        <div class="form-group col-md-4">
            <label for="start_date">Start Date:</label>
            <input type="text" id="start_date" name="start_date" readonly value="{{ request.form.start_date if request.form.start_date else 'Select Date' }}" class="form-control">
        </div>
        <div class="form-group col-md-4">
            <label for="end_date">End Date:</label>
            <input type="text" id="end_date" name="end_date" readonly value="{{ request.form.end_date if request.form.end_date else 'Select Date' }}" class="form-control">
        </div>

        <div class="form-group col-md-6">
            <label for="category">Category:</label>
            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Select Categories
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="select_all_categories">
                        <label class="form-check-label" for="select_all_categories">
                            Select All
                        </label>
                    </div>
                    {% for category in categories %}
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="{{ category }}" id="category{{ loop.index }}" name="category"
                            {% if category in request.form.getlist("category") %} checked {% endif %}>
                            <label class="form-check-label" for="category{{ loop.index }}">
                                {{ category.strip('"') }}
                            </label>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="form-group col-md-6">
            <label for="location">Location:</label>
            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Select Locations
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="select_all_locations">
                        <label class="form-check-label" for="select_all_locations">
                            Select All
                        </label>
                    </div>
                    {% for location in locations %}
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="{{ location }}" id="location{{ loop.index }}" name="location"
                        {% if location in request.form.getlist("location") %} checked {% endif %}>
                            <label class="form-check-label" for="location{{ loop.index }}">
                                {{ location.strip('"') }}
                            </label>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="form-group col-md-12">
            <input type="submit" value="Generate graph" class="btn btn-primary">
        </div>
    </form>
    {% if plot_div %}
        {{ plot_div | safe }}
    {% endif %}
</body>
</html>
